---
title: "EDS 222: Final Project"
author: "Liz Peterson"
format: html
editor_options: 
  chunk_output_type: console
---

```{r}
# Load required packages
library(tidyverse)
library(here)
library(ggplot2)
library(here)
library(hockeystick)
```


```{r}
# Read in data

# 1985/01/01 - 1994/01/01
weather_1985_1994 <- read_csv(here('data/85-94.csv')) %>% # Read in csv
  janitor::clean_names() %>% # convert column names to lower snake case
  select(station, date, hourly_precipitation) %>% # select only columns we are interested in
  mutate(hourly_precipitation = as.numeric(hourly_precipitation))

# 1994/01/02 - 2003/12/31
weather_1994_2003 <- read_csv(here('data/94-03.csv')) %>%
  janitor::clean_names() %>%
  select(station, date, hourly_precipitation) %>%
  mutate(hourly_precipitation = as.numeric(hourly_precipitation))

# 2004/01/01 - 2013/12/31
weather_2004_2014 <- read_csv(here('data/04-14.csv')) %>%
  janitor::clean_names() %>%
  select(station, date, hourly_precipitation) %>%
  mutate(hourly_precipitation = as.numeric(hourly_precipitation))

# 2014/01/01 - 2023/12/31
weather_2014_2023 <- read_csv(here('data/14-23.csv')) %>%
  janitor::clean_names() %>%
  select(station, date, hourly_precipitation) %>%
  mutate(hourly_precipitation = as.numeric(hourly_precipitation))
```

```{r}
print(class(weather_1985_1994$date))
print(class(weather_1985_1994$hourly_precipitation))
```

```{r}
# First preliminary plot of 85 to 94 data
ggplot(weather_1985_1994, aes(date, hourly_precipitation)) +
  geom_point()
```

```{r}
# Aggregate data to get daily precipitation
daily_avg_1985_1994 <- weather_1985_1994 %>%
  mutate(date = as.Date(date)) %>%
  group_by(date) %>%
  summarize(daily_avg_precip = mean(hourly_precipitation))
```

```{r}
ggplot(daily_avg_1985_1994, aes(date, daily_avg_precip)) +
  geom_point()
```


### Try aggregating by month to get a longer term trend
```{r}
# Combine all datasets into one and add a period column
combined_weather_data <- bind_rows(
  weather_1985_1994 %>% mutate(period = "1985-1994"),
  weather_1994_2003 %>% mutate(period = "1994-2003"),
  weather_2004_2014 %>% mutate(period = "2004-2014"),
  weather_2014_2023 %>% mutate(period = "2014-2023")
)

# Aggregate data to get monthly precipitation
monthly_avg_combined <- combined_weather_data %>%
  mutate(date = as.Date(date),  # Ensure 'date' is in Date format
         year_month = floor_date(date, "month")) %>%  # Create year_month column --> floor_date from lubridate
  group_by(period, year_month) %>%  # Group by both 'period' and 'year_month'
  summarize(monthly_avg_precip = mean(hourly_precipitation, na.rm = TRUE))  # Calculate monthly average
```

```{r}

# Plot combined data
ggplot(monthly_avg_combined, aes(x = year_month, y = monthly_avg_precip, color = period)) +
  geom_line() +
  scale_x_date(date_labels = "%b %Y", date_breaks = "18 months") +  # Format x-axis labels
  labs(
    title = "Monthly Average Precipitation by Period",
    x = "Date",
    y = "Monthly Average Precipitation (mm)",
    color = "Period"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 45, hjust = 1))

```

### Testing for a trend over time
```{r}
# Fit a linear regression model to test if there is a significant trend over time
linear_model <- lm(monthly_avg_precip ~ year_month, data = monthly_avg_combined)

# View the summary of the model
summary(linear_model)

```

```{r}
# Add the fitted line to the plot
ggplot(monthly_avg_combined, aes(x = year_month, y = monthly_avg_precip)) +
  geom_point() +  # Scatter plot of the data
  geom_smooth(method = "lm", aes()) +  # Linear model line
  labs(
    title = "Monthly Average Precipitation with Trend",
    x = "Date",
    y = "Monthly Average Precipitation (mm)",
    color = "Period"
  ) +
  theme_minimal()

```

### Use hockeystick data for emissions
```{r}
emissions <- get_emissions()
```

```{r}
us_emissions <- emissions %>%
  filter(country == "United States") %>%
  filter(year >= 1985 & year <= 2023)
```

```{r}
ggplot(us_emissions, aes(x = year, y = co2)) +
  geom_line()
```




